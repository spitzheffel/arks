# 缠论交易分析平台 - 需求规格文档

## 项目概述

构建一个基于缠论理论的加密货币交易分析平台，用于个人交易分析和决策支持。

## 技术栈

- **后端**: Java 17+ / Spring Boot 3 / MyBatis-Plus
- **前端**: Vue 3 + TypeScript + Tailwind CSS
- **数据库**: PostgreSQL
- **首个数据源**: 币安（Binance）

---

## Phase 1: 数据基础模块（MVP）

### 数据模型层级关系

```
数据源 (DataSource)
  └── 市场 (Market)
        └── 交易对 (Symbol)
              ├── 实时数据同步配置
              ├── 历史数据同步配置
              └── K线数据 (Kline) [按时间周期]
                    └── 数据缺口 (DataGap) [缺口记录]
```

- 一个数据源（如币安）包含多个市场（现货、U本位合约、币本位合约）
- 一个市场包含多个交易对（BTC/USDT、ETH/USDT等）
- 每个交易对可独立配置实时数据和历史数据的同步开关
- K线数据按时间周期存储（1m, 3m, 5m, 15m, 30m, 1h, 2h, 4h, 6h, 8h, 12h, 1d, 3d, 1w, 1M）
- 最小周期为 1m，不启用 1s
- 每个交易对的每个时间周期可能存在数据缺口，需要检测和回补

---

### 1. 数据源管理

#### 用户故事
作为交易分析用户，我希望能够配置和管理交易所API连接，以便从不同交易所获取市场数据。

#### 验收标准
- 1.1 用户可以添加新的数据源配置（交易所名称、API Key、Secret Key、API端点）
- 1.2 用户可以编辑已有的数据源配置
- 1.3 用户可以删除数据源配置
- 1.4 用户可以测试数据源连接是否正常
- 1.5 系统支持启用/禁用数据源
- 1.6 API密钥需要加密存储
- 1.7 首期支持币安（Binance）交易所
- 1.8 用户可以配置代理设置（代理类型HTTP/SOCKS5、代理地址、端口、用户名、密码）
- 1.9 用户可以为每个数据源单独配置是否使用代理
- 1.10 用户可以测试代理连接是否正常

### 2. 市场管理

#### 用户故事
作为交易分析用户，我希望能够管理不同的市场类型，以便区分现货和合约等不同交易市场。

#### 验收标准
- 2.1 系统预置市场类型：现货（SPOT）、U本位合约（USDT_M）、币本位合约（COIN_M）
- 2.2 用户可以查看所有市场类型列表
- 2.3 用户可以启用/禁用特定市场类型
- 2.4 每个市场类型关联到特定的数据源

### 3. 交易对管理

#### 用户故事
作为交易分析用户，我希望能够查看所有可用的交易对，并选择性地开启我关注的交易对的数据同步，以便只同步和分析我感兴趣的交易品种。

#### 验收标准
- 3.1 系统自动从交易所同步所有可用的交易对列表（按市场分类）
- 3.2 用户可以查看所有交易对及其基本信息（基础货币、报价货币、价格精度、数量精度、所属市场）
- 3.3 交易对的实时数据同步默认为关闭状态
- 3.4 交易对的历史数据同步默认为关闭状态
- 3.5 用户可以手动开启/关闭指定交易对的实时数据同步
- 3.6 用户可以手动开启/关闭指定交易对的历史数据同步
- 3.7 用户可以按数据源、市场类型筛选交易对
- 3.8 用户可以搜索交易对
- 3.9 用户可以查看哪些交易对已开启数据同步（实时/历史）

### 4. 数据同步管理

#### 用户故事
作为交易分析用户，我希望系统能够为已开启同步的交易对自动同步K线数据，以便我能够进行技术分析。

#### 验收标准
- 4.1 系统支持同步多个时间周期的K线数据（1m, 3m, 5m, 15m, 30m, 1h, 2h, 4h, 6h, 8h, 12h, 1d, 3d, 1w, 1M）
- 4.2 用户可以为已开启同步的交易对配置需要同步的时间周期
- 4.3 实时数据同步：通过WebSocket或定时轮询获取最新K线
- 4.4 历史数据同步：批量拉取指定时间范围的历史K线
- 4.5 用户可以手动触发历史数据同步
- 4.6 系统支持定时自动同步（可配置同步频率）
- 4.7 用户可以查看同步任务状态和历史记录
- 4.8 系统记录每个交易对每个周期的最后同步时间
- 4.9 同步失败时系统记录错误信息并支持重试
- 4.10 只有开启了数据同步的交易对才会被同步
- 4.11 定时/自动同步仅处理启用的数据源、启用的市场以及已开启同步的交易对
- 4.12 自动同步仅处理交易对配置的同步周期
- 4.13 定时增量同步基于最后同步时间追赶；首次启用仅补前一日数据，避免自动全量拉取
- 4.14 停机导致跨度过大时按时间范围分段追赶（单次跨度不超过30天）
- 4.15 所有定时任务按 UTC 时区执行
- 4.16 最小同步周期为 1m，不启用 1s

### 5. 数据缺口检测与回补

#### 用户故事
作为交易分析用户，我希望系统能够检测并修复K线数据中的缺口，以确保分析数据的完整性。

#### 验收标准
- 5.1 系统可以检测指定交易对指定周期的数据缺口
- 5.2 系统可以批量检测所有已开启同步的交易对的数据缺口
- 5.3 用户可以查看数据缺口报告（交易对、时间周期、缺口起止时间、缺失K线数量）
- 5.4 用户可以按交易对、时间周期、缺口状态筛选缺口记录
- 5.5 用户可以手动触发单个缺口回补
- 5.6 用户可以批量触发缺口回补
- 5.7 系统支持自动缺口检测（可配置检测频率）
- 5.8 系统支持自动缺口回补（可配置）
- 5.9 回补完成后系统更新缺口状态（待回补、回补中、已回补、回补失败）
- 5.10 用户可以查看回补历史记录
- 5.11 自动缺口检测与回补仅处理已开启历史同步且配置了对应周期的交易对

---

## Phase 2: 缠论分析核心（待细化）

### 6. 缠论参数管理
### 7. 缠论技术分析

---

## Phase 3: 策略与信号（待细化）

### 8. 常规技术指标分析
### 9. 交易策略管理
### 10. 交易信号管理
### 11. 信号推送通知

---

## Phase 4: 回测（待细化）

### 12. 回测数据管理

---

## 非功能性需求

### 性能要求

- K线数据查询响应时间 < 500ms（单次查询限制1000条）
- 支持存储至少1年的分钟级K线数据
- 历史数据默认永久保留，不自动清理
- 允许手动删除指定范围历史数据（需明确操作）

### 安全要求

- API密钥加密存储
- 敏感操作（删除、禁用）需要前端二次确认
- 本地单用户部署，不对外网暴露，暂不实现用户认证

### 时区规范

- 数据库存储与 API 传输统一使用 UTC（ISO 8601，带 Z 后缀）
- 定时任务按 UTC 时区执行
- 前端展示转换为用户本地时区

### 可用性要求
- 界面响应式设计，支持桌面浏览器
- 操作反馈及时，有加载状态提示
