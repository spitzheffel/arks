# 缠论交易分析平台 - 任务列表

## Phase 1: 数据基础模块（MVP）

### 1. 项目初始化

- [ ] 1.1 后端项目初始化
  - [ ] 1.1.1 创建 Spring Boot 3 项目结构
  - [ ] 1.1.2 配置 MyBatis-Plus
  - [ ] 1.1.3 配置 PostgreSQL 数据源
  - [ ] 1.1.4 配置统一响应格式和异常处理
  - [ ] 1.1.5 配置 Flyway 数据库迁移

- [ ] 1.2 前端项目初始化
  - [ ] 1.2.1 创建 Vue 3 + TypeScript 项目
  - [ ] 1.2.2 配置 Tailwind CSS
  - [ ] 1.2.3 配置路由和状态管理 (Pinia)
  - [ ] 1.2.4 配置 Axios 请求封装
  - [ ] 1.2.5 创建基础布局组件

- [ ] 1.3 数据库初始化
  - [ ] 1.3.1 创建 data_source 表
  - [ ] 1.3.2 创建 market 表
  - [ ] 1.3.3 创建 symbol 表
  - [ ] 1.3.4 创建 kline 表
  - [ ] 1.3.5 创建 data_gap 表
  - [ ] 1.3.6 创建 sync_task 表
  - [ ] 1.3.7 创建 sync_status 表
  - [ ] 1.3.8 创建 system_config 表并插入预置配置

---

### 2. 数据源管理 (需求 1.1-1.10)

- [ ] 2.1 后端 - 数据源 CRUD
  - [ ] 2.1.1 实现 DataSource 实体和 Mapper
  - [ ] 2.1.2 实现 AES-256 加密工具类
  - [ ] 2.1.3 实现 DataSourceService (CRUD + 加密存储)
  - [ ] 2.1.4 实现 DataSourceController (REST API)
  - [ ] 2.1.5 实现软删除和级联禁用逻辑

- [ ] 2.2 后端 - 代理配置
  - [ ] 2.2.1 实现代理配置存储
  - [ ] 2.2.2 实现 OkHttp 代理客户端工厂
  - [ ] 2.2.3 实现代理连接测试接口

- [ ] 2.3 后端 - 币安客户端
  - [ ] 2.3.1 实现 BinanceClient 基础类 (支持代理)
  - [ ] 2.3.2 实现连接测试方法 (ping + serverTime)
  - [ ] 2.3.3 实现 API 限流处理

- [ ] 2.4 前端 - 数据源管理页面
  - [ ] 2.4.1 数据源列表页面
  - [ ] 2.4.2 数据源新增/编辑表单 (含代理配置)
  - [ ] 2.4.3 连接测试功能
  - [ ] 2.4.4 代理测试功能
  - [ ] 2.4.5 启用/禁用开关 (带二次确认弹窗)
  - [ ] 2.4.6 删除确认弹窗 (二次确认)
  - [ ] 2.4.7 API 对接与联调 (请求/响应处理、错误提示、空态、Loading)

---

### 3. 市场管理 (需求 2.1-2.4)

- [ ] 3.1 后端 - 市场管理
  - [ ] 3.1.1 实现 Market 实体和 Mapper
  - [ ] 3.1.2 实现 MarketService
  - [ ] 3.1.3 实现 MarketController
  - [ ] 3.1.4 实现从币安同步市场信息
  - [ ] 3.1.5 实现市场启用/禁用 (级联禁用交易对同步)

- [ ] 3.2 前端 - 市场管理页面
  - [ ] 3.2.1 市场列表页面 (按数据源分组)
  - [ ] 3.2.2 同步市场按钮
  - [ ] 3.2.3 启用/禁用开关 (带二次确认弹窗)
  - [ ] 3.2.4 API 对接与联调 (请求/响应处理、错误提示、空态、Loading)

---

### 4. 交易对管理 (需求 3.1-3.9)

- [ ] 4.1 后端 - 交易对管理
  - [ ] 4.1.1 实现 Symbol 实体和 Mapper
  - [ ] 4.1.2 实现 SymbolService
  - [ ] 4.1.3 实现 SymbolController
  - [ ] 4.1.4 实现从币安同步交易对列表 (exchangeInfo)
  - [ ] 4.1.5 实现实时/历史同步开关 (默认关闭)
  - [ ] 4.1.6 实现同步周期配置
  - [ ] 4.1.7 实现周期合法性校验 (拒绝 1s，最小周期为 1m)

- [ ] 4.2 前端 - 交易对管理页面
  - [ ] 4.2.1 交易对列表页面 (支持筛选和搜索)
  - [ ] 4.2.2 同步交易对按钮
  - [ ] 4.2.3 实时同步开关 (带二次确认弹窗)
  - [ ] 4.2.4 历史同步开关 (带二次确认弹窗)
  - [ ] 4.2.5 同步周期配置弹窗 (不显示 1s 选项)
  - [ ] 4.2.6 API 对接与联调 (请求/响应处理、错误提示、空态、Loading)

---

### 5. 数据同步管理 (需求 4.1-4.16)

- [ ] 5.1 后端 - K线数据存储
  - [ ] 5.1.1 实现 Kline 实体和 Mapper
  - [ ] 5.1.2 实现 KlineService (批量插入/更新)
  - [ ] 5.1.3 实现 K线查询接口 (带分页和时间范围)
  - [ ] 5.1.4 实现手动删除历史数据接口 (物理删除，按交易对+周期+时间范围)
  - [ ] 5.1.5 删除历史数据时同步删除相关缺口记录
  - [ ] 5.1.6 删除历史数据后重新计算 sync_status.last_kline_time 为当前最新K线时间
  - [ ] 5.1.7 删除历史数据后关闭该交易对该周期的自动回补开关 (交易对+周期级别，需手动重新开启)

- [ ] 5.2 后端 - 同步任务管理
  - [ ] 5.2.1 实现 SyncTask 实体和 Mapper
  - [ ] 5.2.2 实现 SyncStatus 实体和 Mapper
  - [ ] 5.2.3 实现 SyncService (任务创建/状态更新)
  - [ ] 5.2.4 实现 SyncController

- [ ] 5.3 后端 - 历史数据同步
  - [ ] 5.3.1 实现币安 K线 REST API 调用
  - [ ] 5.3.2 实现历史数据批量拉取 (分段处理，单次≤30天)
  - [ ] 5.3.3 实现手动触发历史同步接口 (复用同步对象筛选规则，校验数据源/市场/交易对启用状态)
  - [ ] 5.3.4 实现定时增量同步 (检查 sync.history.auto 开关)
  - [ ] 5.3.5 实现首次启用仅补前一日数据逻辑

- [ ] 5.4 后端 - 实时数据同步
  - [ ] 5.4.1 实现币安 WebSocket K线订阅
  - [ ] 5.4.2 实现 WebSocket 断线重连
  - [ ] 5.4.3 实现 WebSocket 管理器 (动态订阅/取消)
  - [ ] 5.4.4 实现断线期间数据补充 (REST API)

- [ ] 5.5 后端 - 定时任务
  - [ ] 5.5.1 实现 SystemConfig 读取服务
  - [ ] 5.5.2 实现交易对列表定时同步 (sync.symbol.cron)
  - [ ] 5.5.3 实现历史数据定时增量同步 (检查 sync.history.auto 开关)
  - [ ] 5.5.4 实现定时任务动态配置刷新
  - [ ] 5.5.5 配置 SchedulerConfig 时区为 UTC
  - [ ] 5.5.6 实现同步对象筛选逻辑 (仅处理启用的数据源+市场+已开启同步的交易对)
  - [ ] 5.5.7 实现 sync.realtime.enabled 全局开关检查

- [ ] 5.6 前端 - 数据同步页面
  - [ ] 5.6.1 同步任务列表页面
  - [ ] 5.6.2 同步状态查看
  - [ ] 5.6.3 手动触发历史同步按钮
  - [ ] 5.6.4 K线数据查看/图表展示
  - [ ] 5.6.5 手动删除历史数据入口 (带二次确认弹窗，需输入确认文字)
  - [ ] 5.6.6 API 对接与联调 (请求/响应处理、错误提示、空态、Loading)

---

### 6. 数据缺口检测与回补 (需求 5.1-5.11)

- [ ] 6.1 后端 - 缺口检测
  - [ ] 6.1.1 实现 DataGap 实体和 Mapper
  - [ ] 6.1.2 实现缺口检测算法 (基于时间连续性)
  - [ ] 6.1.3 实现单交易对缺口检测接口
  - [ ] 6.1.4 实现批量缺口检测接口
  - [ ] 6.1.5 实现定时缺口检测 (sync.gap_detect.cron)
  - [ ] 6.1.6 缺口检测仅处理已开启历史同步且配置了对应周期的交易对

- [ ] 6.2 后端 - 缺口回补
  - [ ] 6.2.1 实现单个缺口回补
  - [ ] 6.2.2 实现批量缺口回补 (带限流)
  - [ ] 6.2.3 实现自动缺口回补 (sync.gap_fill.auto)
  - [ ] 6.2.4 实现回补状态流转 (PENDING→FILLING→FILLED/FAILED)
  - [ ] 6.2.5 实现回补重试机制
  - [ ] 6.2.6 实现交易对+周期级别自动回补开关配置 (持久化)
  - [ ] 6.2.7 自动回补执行前同时检查全局开关 sync.gap_fill.auto 与交易对+周期开关
  - [ ] 6.2.8 提供自动回补开关查询/更新接口 (供前端手动开启/关闭)

- [ ] 6.3 前端 - 缺口管理页面
  - [ ] 6.3.1 缺口列表页面 (支持筛选)
  - [ ] 6.3.2 手动检测缺口按钮
  - [ ] 6.3.3 单个/批量回补按钮
  - [ ] 6.3.4 缺口状态展示
  - [ ] 6.3.5 自动回补开关配置入口 (交易对+周期级别)
  - [ ] 6.3.6 API 对接与联调 (请求/响应处理、错误提示、空态、Loading)

---

### 7. 系统配置管理

- [ ] 7.1 后端 - 配置管理
  - [ ] 7.1.1 实现 SystemConfig 实体和 Mapper
  - [ ] 7.1.2 实现 ConfigService
  - [ ] 7.1.3 实现 ConfigController

- [ ] 7.2 前端 - 配置管理页面
  - [ ] 7.2.1 配置列表页面
  - [ ] 7.2.2 配置编辑功能
  - [ ] 7.2.3 API 对接与联调 (请求/响应处理、错误提示、空态、Loading)

---

## 验收测试

- [ ] 8.1 数据源管理验收
  - [ ] 8.1.1 验证数据源 CRUD 功能
  - [ ] 8.1.2 验证代理配置和测试
  - [ ] 8.1.3 验证 API 密钥加密存储
  - [ ] 8.1.4 验证软删除和级联禁用

- [ ] 8.2 市场和交易对管理验收
  - [ ] 8.2.1 验证市场同步功能
  - [ ] 8.2.2 验证交易对同步功能
  - [ ] 8.2.3 验证同步开关默认关闭

- [ ] 8.3 数据同步验收
  - [ ] 8.3.1 验证历史数据同步
  - [ ] 8.3.2 验证实时数据同步 (WebSocket)
  - [ ] 8.3.3 验证定时任务执行 (UTC 时区)
  - [ ] 8.3.4 验证 K线数据查询性能 (<500ms)
  - [ ] 8.3.5 验证同步对象筛选 (禁用的数据源/市场/交易对不被同步)
  - [ ] 8.3.6 验证 sync.realtime.enabled 全局开关
  - [ ] 8.3.7 验证周期合法性校验 (拒绝 1s)
  - [ ] 8.3.8 验证手动删除历史数据功能
  - [ ] 8.3.9 验证删除历史数据后关闭该交易对该周期的自动回补开关
  - [ ] 8.3.10 验证手动触发历史同步也走筛选规则 (禁用对象无法手动同步)

- [ ] 8.4 缺口检测与回补验收
  - [ ] 8.4.1 验证缺口检测准确性
  - [ ] 8.4.2 验证缺口回补功能
  - [ ] 8.4.3 验证自动回补限流策略
  - [ ] 8.4.4 验证缺口检测仅处理符合条件的交易对
  - [ ] 8.4.5 验证交易对+周期自动回补开关生效 (关闭不自动回补，开启后恢复)

- [ ] 8.5 二次确认弹窗验收
  - [ ] 8.5.1 验证数据源删除/启用/禁用二次确认
  - [ ] 8.5.2 验证市场启用/禁用二次确认
  - [ ] 8.5.3 验证交易对同步开关二次确认
  - [ ] 8.5.4 验证删除历史数据二次确认 (需输入确认文字)
